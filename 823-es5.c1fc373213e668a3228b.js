!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=s(e);if(t){var o=s(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return a(this,r)}}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunkcook_book=self.webpackChunkcook_book||[]).push([[823],{8823:function(t,o,a){"use strict";a.r(o),a.d(o,{AccountModule:function(){return Ae}});var s=a(8583),l=a(3679),u=a(1095),c=a(3738),m=a(7539),g=a(1769),f=a(8295),d=a(6627),p=a(9983),v=a(6398),h=a(9876),w=a(3423),y=a(6025),Z=a(1209),b=a(7851),T=a(5917),k=a(3342),S=a(5304),x=a(6782),q=a(7716),A=a(2684),I=a(448);function N(e,t){if(1&e&&(q.TgZ(0,"mat-error",14),q._UZ(1,"span",15),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function U(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,N,2,1,"mat-error",13),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(2);q.xp6(1),q.Q6J("ngIf",i.f.email.hasError(r.type)&&(i.f.email.dirty||i.f.email.touched))}}function J(e,t){if(1&e){var r=q.EpF();q.TgZ(0,"form",5),q.TgZ(1,"mat-form-field",6),q.TgZ(2,"mat-icon",7),q._uU(3,"email"),q.qZA(),q.TgZ(4,"input",8),q.NdJ("keyup.enter",function(){return q.CHM(r),q.oxw().forgotPassword()}),q.qZA(),q.YNc(5,U,2,1,"mat-error",9),q.qZA(),q.TgZ(6,"div",10),q.TgZ(7,"button",11),q._uU(8,"Cancel"),q.qZA(),q.TgZ(9,"app-save-button",12),q.NdJ("save",function(){return q.CHM(r),q.oxw().forgotPassword()}),q.qZA(),q.qZA(),q.qZA()}if(2&e){var i=q.oxw();q.Q6J("formGroup",i.form),q.xp6(5),q.Q6J("ngForOf",i.validationMessages.email),q.xp6(4),q.Q6J("dirty",i.form.dirty)("valid",i.form.valid)("isSaving",i.isSubmitting)}}function E(e,t){1&e&&(q.TgZ(0,"div"),q._uU(1," Please check your email or your spam folder for a password reset link. "),q.qZA())}var P=function(){var t=function(t){i(a,t);var o=n(a);function a(t,r,i,n,s,l){var u;return e(this,a),(u=o.call(this)).fb=t,u.route=r,u.router=i,u.accountService=n,u.messageService=s,u.cdr=l,u.validationMessages=b.rm,u.showLookInYourEmail=!1,u.isSubmitting=!1,u.form=u.createForm(),u}return r(a,[{key:"ngOnInit",value:function(){var e=this.route.snapshot.queryParams.email;void 0!==e&&(this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.f.email.setValue(e),this.f.email.markAsTouched(),this.f.email.markAsDirty())}},{key:"f",get:function(){return this.form.controls}},{key:"createForm",value:function(){return this.fb.group({email:["",[l.kI.required,l.kI.minLength(2),l.kI.maxLength(120),l.kI.email]]})}},{key:"forgotPassword",value:function(){var e=this;this.form.invalid||(this.isSubmitting=!0,this.accountService.forgotPassword(this.form.getRawValue().email).pipe((0,k.b)(function(t){"Please login through your Google Account"===t.message?(e.messageService.add({severity:Z.r.Warning,summary:"No Password to reset",detail:t.message,life:8e3}),e.f.email.setErrors({googleLogin:!0}),e.cdr.markForCheck(),e.form.updateValueAndValidity()):e.showLookInYourEmail=!0,e.isSubmitting=!1,console.log("email send result",t,e.isSubmitting)}),(0,S.K)(function(t){return 400===t.status&&e.messageService.add({severity:Z.r.Error,summary:"Email Error",detail:"The server did not receive a correctly formatted email address.",life:8e3}),404===t.status&&(e.messageService.add({severity:Z.r.Warning,summary:"No Email account found",detail:t.error.message,life:8e3}),e.f.email.setErrors({registrationRequired:!0},{emitEvent:!0}),e.cdr.markForCheck()),e.isSubmitting=!1,(0,T.of)()}),(0,x.R)(this.ngUnsubscribe)).subscribe(function(t){console.log("we got to the subscribe conclusion?",t,e.isSubmitting),e.isSubmitting=!1}))}}]),a}(y.V);return t.\u0275fac=function(e){return new(e||t)(q.Y36(l.qu),q.Y36(w.gz),q.Y36(w.F0),q.Y36(h.B),q.Y36(A.e),q.Y36(q.sBO))},t.\u0275cmp=q.Xpm({type:t,selectors:[["app-forgot-password"]],features:[q.qOj],decls:9,vars:2,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],[3,"ngSwitch"],["mat-card-content","",3,"formGroup",4,"ngSwitchDefault"],[4,"ngSwitchCase"],["mat-card-content","",3,"formGroup"],[1,"mt-1","w-100"],["matPrefix","",1,"pr-1"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","email",3,"keyup.enter"],[4,"ngFor","ngForOf"],[1,"flex-box","flex-justify-end","mt-4"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login",1,"mr-1"],["label","Submit",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(q.TgZ(0,"mat-card-header"),q.TgZ(1,"mat-card-title"),q.TgZ(2,"h2",0),q.TgZ(3,"mat-icon",1),q._uU(4,"memory"),q.qZA(),q._uU(5,"Forgot Password"),q.qZA(),q.qZA(),q.qZA(),q.TgZ(6,"div",2),q.YNc(7,J,10,5,"form",3),q.YNc(8,E,2,0,"div",4),q.qZA()),2&e&&(q.xp6(6),q.Q6J("ngSwitch",t.showLookInYourEmail),q.xp6(2),q.Q6J("ngSwitchCase",!0))},directives:[c.dk,c.n5,d.Hw,s.RF,s.ED,s.n9,l._Y,l.JL,c.dn,l.sg,f.KE,f.qo,p.Nt,l.Fj,l.JJ,l.u,s.sg,u.lW,w.rH,I.t,f.TO,s.O5],styles:[""]}),t}(),_=a(8948),F=a(5798),C=a(8851),O=["passwordInput"];function Y(e,t){if(1&e&&(q.TgZ(0,"mat-error",23),q._UZ(1,"span",24),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function L(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,Y,2,1,"mat-error",22),q.qZA()),2&e){var r=t.$implicit,i=q.oxw();q.xp6(1),q.Q6J("ngIf",i.f.usernameControl.hasError(r.type)&&(i.f.usernameControl.dirty||i.f.usernameControl.touched))}}function M(e,t){if(1&e&&(q.TgZ(0,"mat-error",23),q._UZ(1,"span",24),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function Q(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,M,2,1,"mat-error",22),q.qZA()),2&e){var r=t.$implicit,i=q.oxw();q.xp6(1),q.Q6J("ngIf",i.f.passwordControl.hasError(r.type)&&(i.f.passwordControl.dirty||i.f.passwordControl.touched))}}var R=function(){var t=function(t){i(a,t);var o=n(a);function a(t,r,i,n,s,l){var u;return e(this,a),(u=o.call(this)).fb=t,u.authService=r,u.loginService=i,u.router=n,u.messageService=s,u.cdr=l,u.validationMessages=b.rm,u.isSubmitting=!1,u}return r(a,[{key:"ngOnInit",value:function(){this.loginForm=this.createForm()}},{key:"f",get:function(){return this.loginForm.controls}},{key:"createForm",value:function(){return this.fb.group({usernameControl:["",[l.kI.required,l.kI.minLength(2),l.kI.maxLength(120),l.kI.email]],passwordControl:["",[l.kI.required,l.kI.minLength(2)]],rememberControl:!1})}},{key:"rememberChange",value:function(e){console.log("Im not going to remember you, terrible with names",e)}},{key:"login",value:function(){var e=this;if(this.isSubmitting=!0,this.loginForm.invalid)return null;this.passwordInput.nativeElement.blur();var t=this.loginForm.getRawValue();this.loginService.login(t.usernameControl,t.passwordControl,!1).pipe((0,k.b)(function(r){return e.loginResult(r,t)}),(0,S.K)(function(t){return e.catchFormError(t)}),(0,x.R)(this.ngUnsubscribe)).subscribe()}},{key:"loginResult",value:function(e,t){if(this.isSubmitting=!1,"Successful login"===e.message)this.router.navigate(["/savoury/recipes/browse"]);else if(e.message.indexOf("Lockout")>-1){var r=Number(e.message.substring(9));r&&r>4&&(console.log("here we locking routing,",r,"/account/forgot-password?email=".concat(t.usernameControl)),this.router.navigate(["/account/forgot-password"],{queryParams:{email:t.usernameControl}}),this.messageService.add({severity:Z.r.Warning,summary:"Lockout",detail:"Please wait 20 minutes to try again or reset password.",life:12e3}))}else this.messageService.add({severity:Z.r.Warning,summary:"Login problem",detail:e.message,life:12e3})}},{key:"catchFormError",value:function(e){return this.isSubmitting=!1,e.status===_.WE.BadRequest?(this.f.passwordControl.setErrors({wrongPassword:!0},{emitEvent:!0}),this.cdr.markForCheck(),this.messageService.add({severity:Z.r.Warning,summary:"Password error",detail:'You can reset your password through "Forgot Password"',life:12e3})):this.messageService.add(e.status===_.WE.Forbidden?{severity:Z.r.Warning,summary:"Account Issue",detail:'Your Account has been deactivated, please email support for more info."',life:12e3}:{severity:Z.r.Error,summary:"Major Error",detail:e.message,life:12e3}),(0,T.of)()}},{key:"googleSignIn",value:function(){this.authService.signIn(C.tV.PROVIDER_ID)}}]),a}(y.V);return t.\u0275fac=function(e){return new(e||t)(q.Y36(l.qu),q.Y36(C.xE),q.Y36(F.r),q.Y36(w.F0),q.Y36(A.e),q.Y36(q.sBO))},t.\u0275cmp=q.Xpm({type:t,selectors:[["app-login-form"]],viewQuery:function(e,t){var r;(1&e&&q.Gf(O,5),2&e)&&(q.iGM(r=q.CRH())&&(t.passwordInput=r.first))},features:[q.qOj],decls:39,vars:6,consts:[[1,"flex-box","flex-align-center"],["aria-hidden","false","aria-label","User Login",1,"mr-2"],["mat-card-content","",3,"formGroup"],[1,"flex-box","flex-column",3,"keyup.enter"],[1,"mt-1"],["matPrefix","",1,"pr-1"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","usernameControl"],[4,"ngFor","ngForOf"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","passwordControl"],["passwordInput",""],[1,"flex-box","flex-justify-space-between","flex-align-center","mt-2"],["aria-label","Remember Me","formControlName","rememberControl",3,"change"],["mat-flat-button","","type","button","aria-label","Need an email password reminder?","routerLink","/account/forgot-password"],[1,"mt-4","mb-4","flex-box","flex-column"],["color","accent","label","Login","iconName","chevron_right","iconPosition","right",3,"dirty","valid","isSaving","save"],[1,"pcb-divider"],["mat-flat-button","","color","primary","type","button","aria-label","Sign in with Google button",1,"w-100",3,"click"],[1,"flex-box","flex-row","flex-align-center"],["src","assets/svg/google.svg","title","Google Icon",1,"svg-icon"],[1,"flex-grow-1","flex-box","flex-justify-center"],[1,"pl-2"],["mat-flat-button","","type","button","routerLink","/account/register","aria-label","Sign up Button"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(q.TgZ(0,"mat-card-header"),q.TgZ(1,"mat-card-title"),q.TgZ(2,"h1",0),q.TgZ(3,"mat-icon",1),q._uU(4,"account_circle"),q.qZA(),q._uU(5,"Login"),q.qZA(),q.qZA(),q.qZA(),q.TgZ(6,"form",2),q.TgZ(7,"div",3),q.NdJ("keyup.enter",function(){return t.login()}),q.TgZ(8,"mat-form-field",4),q.TgZ(9,"mat-icon",5),q._uU(10,"email"),q.qZA(),q._UZ(11,"input",6),q.YNc(12,L,2,1,"mat-error",7),q.qZA(),q.TgZ(13,"mat-form-field",4),q.TgZ(14,"mat-icon",5),q._uU(15,"lock"),q.qZA(),q._UZ(16,"input",8,9),q.YNc(18,Q,2,1,"mat-error",7),q.qZA(),q.qZA(),q.TgZ(19,"div",10),q.TgZ(20,"mat-checkbox",11),q.NdJ("change",function(e){return t.rememberChange(e)}),q._uU(21,"Remember Me"),q.qZA(),q.TgZ(22,"button",12),q._uU(23,"Forgot password?"),q.qZA(),q.qZA(),q.TgZ(24,"div",13),q.TgZ(25,"app-save-button",14),q.NdJ("save",function(){return t.login()}),q.qZA(),q.TgZ(26,"div",15),q._uU(27,"OR"),q.qZA(),q.TgZ(28,"button",16),q.NdJ("click",function(){return t.googleSignIn()}),q.TgZ(29,"span",17),q._UZ(30,"img",18),q.TgZ(31,"span",19),q._uU(32,"Continue with Google"),q.qZA(),q.qZA(),q.qZA(),q.qZA(),q.qZA(),q._UZ(33,"mat-divider"),q.TgZ(34,"mat-card-footer",17),q.TgZ(35,"span",20),q._uU(36,"New to Provisioner's CookBook?"),q.qZA(),q.TgZ(37,"button",21),q._uU(38,"Register now!"),q.qZA(),q.qZA()),2&e&&(q.xp6(6),q.Q6J("formGroup",t.loginForm),q.xp6(6),q.Q6J("ngForOf",t.validationMessages.email),q.xp6(6),q.Q6J("ngForOf",t.validationMessages.password),q.xp6(7),q.Q6J("dirty",t.loginForm.dirty)("valid",t.loginForm.valid)("isSaving",t.isSubmitting))},directives:[c.dk,c.n5,d.Hw,l._Y,l.JL,c.dn,l.sg,f.KE,f.qo,p.Nt,l.Fj,l.JJ,l.u,s.sg,m.oG,u.lW,w.rH,I.t,g.d,c.rt,f.TO,s.O5],styles:['.mat-card-footer[_ngcontent-%COMP%]{height:3em;display:flex}.pcb-divider[_ngcontent-%COMP%]{overflow:hidden;text-align:center;margin-top:1em;margin-bottom:1em}.pcb-divider[_ngcontent-%COMP%]:after, .pcb-divider[_ngcontent-%COMP%]:before{content:"";display:inline-block;background-color:#eee3d5;height:1px;position:relative;vertical-align:middle;width:50%}.pcb-divider[_ngcontent-%COMP%]:before{right:.5em;margin-left:-50%}.pcb-divider[_ngcontent-%COMP%]:after{left:.5em;margin-right:-50%}']}),t}(),G=a(3720),V=a(1188),H=a(8069);function j(e,t){1&e&&(q.TgZ(0,"mat-card"),q._UZ(1,"router-outlet"),q.qZA())}function W(e,t){1&e&&q._UZ(0,"app-loading-indicator")}var D=function(){var t=function(t){i(a,t);var o=n(a);function a(t,r,i,n,s,l){var u;return e(this,a),(u=o.call(this)).authService=t,u.dialogService=r,u.loginService=i,u.router=n,u.messageService=s,u.storageService=l,u.isGettingJwt=!1,u}return r(a,[{key:"ngOnInit",value:function(){var e=this.storageService.getItem("google-user");e&&e.length>0&&"null"!==e?this.getGoogleJwtToken(e):this.listenAuthState()}},{key:"listenAuthState",value:function(){var e=this;this.authService.authState.pipe((0,k.b)(function(t){e.messageService.add({severity:Z.r.Success,summary:"Authentication Successful",detail:"Google Account Authenticated, attempting to logon to app."}),t?(e.googleUserData=t,e.storageService.setItem("google-user",JSON.stringify(e.googleUserData)),JSON.parse(e.storageService.getItem("user")),e.getGoogleJwtToken(e.googleUserData)):localStorage.setItem("google-user",null),e.loggedIn=null!=t}),(0,S.K)(function(t){return e.dialogService.confirm(Z.r.Alert,"Error on Google login attempt",t.message)}),(0,x.R)(this.ngUnsubscribe)).subscribe()}},{key:"getGoogleJwtToken",value:function(e){var t=this;this.isGettingJwt=!0,this.loginService.getTokenUsingGoogleToken(e).pipe((0,k.b)(function(e){t.isGettingJwt=!1,e&&"string"==typeof e?(t.dialogService.confirm(Z.r.Information,"Registration required","We currently don't have an account registered to that address."),t.router.navigate(["/account/register"])):t.router.navigate(["/savoury/recipes"])}),(0,S.K)(function(e){return e.status===_.WE.Forbidden&&"OK"===e.statusText&&(t.dialogService.confirm(Z.r.Alert,"403 response","Likely the cached google token has expired, try refreshing browser and logging in with your Google account again."),t.googleClear()),t.dialogService.alert("Google Login Error",e.message),t.isGettingJwt=!1,(0,T.of)()}),(0,x.R)(this.ngUnsubscribe)).subscribe()}},{key:"googleClear",value:function(){localStorage.setItem("google-user",null)}}]),a}(y.V);return t.\u0275fac=function(e){return new(e||t)(q.Y36(C.xE),q.Y36(G.x),q.Y36(F.r),q.Y36(w.F0),q.Y36(A.e),q.Y36(V.V))},t.\u0275cmp=q.Xpm({type:t,selectors:[["app-login"]],features:[q.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["showLoading",""]],template:function(e,t){if(1&e&&(q.YNc(0,j,2,0,"mat-card",0),q.YNc(1,W,1,0,"ng-template",null,1,q.W1O)),2&e){var r=q.MAs(2);q.Q6J("ngIf",!t.isGettingJwt)("ngIfElse",r)}},directives:[s.O5,c.a8,w.lC,H.Q],styles:[""]}),t}(),B=function t(){e(this,t),this.loginProvider="Local"},$=a(8049),K=a(5435),z=a(3190);function X(e,t){if(1&e&&(q.TgZ(0,"mat-error",19),q._UZ(1,"span",20),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function ee(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,X,2,1,"mat-error",18),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(2);q.xp6(1),q.Q6J("ngIf",i.f.firstName.hasError(r.type)&&(i.f.firstName.dirty||i.f.firstName.touched))}}function te(e,t){if(1&e&&(q.TgZ(0,"mat-error",19),q._UZ(1,"span",20),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function re(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,te,2,1,"mat-error",18),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(2);q.xp6(1),q.Q6J("ngIf",i.f.lastName.hasError(r.type)&&(i.f.lastName.dirty||i.f.lastName.touched))}}function ie(e,t){if(1&e&&(q.TgZ(0,"mat-error",19),q._UZ(1,"span",20),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function oe(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,ie,2,1,"mat-error",18),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(2);q.xp6(1),q.Q6J("ngIf",i.f.email.hasError(r.type)&&(i.f.email.dirty||i.f.email.touched))}}function ne(e,t){if(1&e&&(q.TgZ(0,"mat-error",19),q._UZ(1,"span",20),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function ae(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,ne,2,1,"mat-error",18),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(3);q.xp6(1),q.Q6J("ngIf",i.f.password.hasError(r.type)&&(i.f.password.dirty||i.f.password.touched))}}function se(e,t){if(1&e&&(q.TgZ(0,"div"),q.TgZ(1,"mat-form-field",11),q._UZ(2,"input",21),q.YNc(3,ae,2,1,"mat-error",8),q.qZA(),q.qZA()),2&e){var r=q.oxw(2);q.xp6(3),q.Q6J("ngForOf",r.validationMessages.password)}}function le(e,t){if(1&e){var r=q.EpF();q.TgZ(0,"form",4),q.NdJ("keyup.enter",function(){return q.CHM(r),q.oxw().register()}),q.TgZ(1,"div",5),q.TgZ(2,"mat-form-field",6),q._UZ(3,"input",7),q.YNc(4,ee,2,1,"mat-error",8),q.qZA(),q.TgZ(5,"mat-form-field",9),q._UZ(6,"input",10),q.YNc(7,re,2,1,"mat-error",8),q.qZA(),q.qZA(),q.TgZ(8,"div"),q.TgZ(9,"mat-form-field",11),q._UZ(10,"input",12),q.YNc(11,oe,2,1,"mat-error",8),q.qZA(),q.qZA(),q.YNc(12,se,4,1,"div",3),q.TgZ(13,"div",13),q.TgZ(14,"mat-checkbox",14),q.NdJ("change",function(){return q.CHM(r),q.oxw().form.markAsTouched()}),q._uU(15,"Accept Terms and conditions (when we get some)"),q.qZA(),q.qZA(),q.TgZ(16,"div",15),q.TgZ(17,"button",16),q._uU(18,"Cancel"),q.qZA(),q.TgZ(19,"app-save-button",17),q.NdJ("save",function(){return q.CHM(r),q.oxw().register()}),q.qZA(),q.qZA(),q.qZA()}if(2&e){var i=q.oxw();q.Q6J("formGroup",i.form),q.xp6(4),q.Q6J("ngForOf",i.validationMessages.username),q.xp6(3),q.Q6J("ngForOf",i.validationMessages.username),q.xp6(4),q.Q6J("ngForOf",i.validationMessages.email),q.xp6(1),q.Q6J("ngIf","GOOGLE"!==i.newUser.loginProvider),q.xp6(7),q.Q6J("dirty",i.form.dirty)("valid",i.form.valid)("isSaving",i.isSubmitting)}}function ue(e,t){1&e&&(q.TgZ(0,"div"),q.TgZ(1,"p"),q.TgZ(2,"strong"),q._uU(3,"Note"),q.qZA(),q._uU(4," - Email is currently trapped in mailtrap.io"),q.qZA(),q.TgZ(5,"p"),q._uU(6,"Please look in your email account (or double check your spam) for a registration email."),q.qZA(),q.qZA())}var ce=function(){var t=function(t){i(a,t);var o=n(a);function a(t,r,i,n,s,l){var u;return e(this,a),(u=o.call(this)).formBuilder=t,u.accountService=r,u.loginService=i,u.messageService=n,u.storageService=s,u.router=l,u.newUser=new B,u.validationMessages=b.rm,u.displayAwaitingVerificationEmail=!1,u.isSubmitting=!1,u}return r(a,[{key:"ngOnInit",value:function(){var e=this.storageService.getItem("google-user");if(e){var t=JSON.parse(e);this.newUser=t&&null!==t?{firstName:t.firstName,lastName:t.lastName,email:t.email,loginProvider:t.provider,loginProviderId:t.id,photoUrl:t.photoUrl,verified:new Date}:new B}this.createForm(this.newUser)}},{key:"f",get:function(){return this.form.controls}},{key:"createForm",value:function(e){this.form=this.formBuilder.group({firstName:[e.firstName,l.kI.required],lastName:[e.lastName,l.kI.required],email:[e.email,[l.kI.required,l.kI.email]],acceptTerms:[!1,l.kI.requiredTrue]}),"GOOGLE"!==this.newUser.loginProvider?this.form.addControl("password",new l.NI("",[l.kI.required,l.kI.minLength(6)])):this.f.email.disable()}},{key:"register",value:function(){var e=this;if(!this.form.invalid){this.isSubmitting=!0;var t=this.form.getRawValue();this.newUser.firstName=t.firstName,this.newUser.lastName=t.lastName,this.newUser.email=t.email,"GOOGLE"!==this.newUser.loginProvider&&(this.newUser.password=t.password),console.log("register the form",this.form.getRawValue(),this.newUser),this.accountService.register(this.newUser).pipe((0,$.P)(),(0,K.h)(function(t){return e.isSubmitting=!1,console.log("isSubmitting",e.isSubmitting),"Email address is already registered"===t.message?(e.messageService.add({severity:Z.r.Warning,summary:"Email Conflict",detail:"It seems this email account is already registered with us.",life:12e3}),e.f.email.setErrors({emailConflict:!0}),!1):"GOOGLE"===e.newUser.loginProvider||(e.displayAwaitingVerificationEmail=!0,!1)}),(0,z.w)(function(){return e.loginService.login(e.newUser.email,null,!0)}),(0,K.h)(function(e){return"Successful login"===e.message}),(0,k.b)(function(){return e.router.navigate(["/savoury/browse"])}),(0,S.K)(function(t){return e.isSubmitting=!1,e.messageService.add({severity:Z.r.Error,summary:"Something terrible happened",detail:t.message,life:12e3}),(0,T.of)()}),(0,x.R)(this.ngUnsubscribe)).subscribe(function(){e.isSubmitting=!1,console.log("subscription finished",e.isSubmitting)})}}}]),a}(y.V);return t.\u0275fac=function(e){return new(e||t)(q.Y36(l.qu),q.Y36(h.B),q.Y36(F.r),q.Y36(A.e),q.Y36(V.V),q.Y36(w.F0))},t.\u0275cmp=q.Xpm({type:t,selectors:[["app-register-form"]],features:[q.qOj],decls:8,vars:2,consts:[[1,"flex-box","flex-align-center"],["aria-hidden","false","aria-label","Register New User",1,"mr-2"],["mat-card-content","",3,"formGroup","keyup.enter",4,"ngIf"],[4,"ngIf"],["mat-card-content","",3,"formGroup","keyup.enter"],[1,"flex-box","flex-row","mt-2"],[1,"mr-2","w-45"],["matInput","","type","text","placeholder","First Name *","Title","First Name","formControlName","firstName"],[4,"ngFor","ngForOf"],[1,"w-50"],["matInput","","type","text","placeholder","Last Name *","Title","Last Name","formControlName","lastName"],[1,"w-100"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","email"],[1,"mt-2","mb-4"],["aria-label","Accept Terms and conditions","formControlName","acceptTerms",3,"change"],[1,"flex-box","flex-justify-end"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login",1,"mr-1"],["color","accent","iconName","chevron_right","iconPosition","right","label","Register",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","password"]],template:function(e,t){1&e&&(q.TgZ(0,"mat-card-header"),q.TgZ(1,"mat-card-title"),q.TgZ(2,"h1",0),q.TgZ(3,"mat-icon",1),q._uU(4,"person_add"),q.qZA(),q._uU(5,"Register"),q.qZA(),q.qZA(),q.qZA(),q.YNc(6,le,20,8,"form",2),q.YNc(7,ue,7,0,"div",3)),2&e&&(q.xp6(6),q.Q6J("ngIf",!!t.form&&!t.displayAwaitingVerificationEmail),q.xp6(1),q.Q6J("ngIf",t.displayAwaitingVerificationEmail))},directives:[c.dk,c.n5,d.Hw,s.O5,l._Y,l.JL,c.dn,l.sg,f.KE,p.Nt,l.Fj,l.JJ,l.u,s.sg,m.oG,u.lW,w.rH,I.t,f.TO],styles:[""]}),t}(),me=(function(e){e[e.Verifying=0]="Verifying",e[e.Failed=1]="Failed"}(me||(me={})),me),ge=(function(e){e[e.Validating=0]="Validating",e[e.Valid=1]="Valid",e[e.Invalid=2]="Invalid"}(ge||(ge={})),ge),fe=a(8002);function de(e,t){1&e&&(q.TgZ(0,"div"),q._uU(1," Validating token... "),q.qZA())}function pe(e,t){1&e&&(q.TgZ(0,"div",7),q.TgZ(1,"span"),q._uU(2,"Token validation failed, you can get a new reset token at "),q.qZA(),q.TgZ(3,"button",8),q._uU(4,"Forgot Password"),q.qZA(),q.qZA())}function ve(e,t){if(1&e&&(q.TgZ(0,"mat-error",18),q._UZ(1,"span",19),q.qZA()),2&e){var r=q.oxw().$implicit;q.xp6(1),q.Q6J("innerHTML",r.message,q.oJD)}}function he(e,t){if(1&e&&(q.TgZ(0,"mat-error"),q.YNc(1,ve,2,1,"mat-error",17),q.qZA()),2&e){var r=t.$implicit,i=q.oxw(2);q.xp6(1),q.Q6J("ngIf",i.fPassword.hasError(r.type)&&(i.fPassword.dirty||i.fPassword.touched))}}function we(e,t){if(1&e){var r=q.EpF();q.TgZ(0,"form",9),q.TgZ(1,"div",7),q.TgZ(2,"mat-form-field",10),q.TgZ(3,"mat-icon",11),q._uU(4,"lock"),q.qZA(),q.TgZ(5,"input",12),q.NdJ("keyup.enter",function(){return q.CHM(r),q.oxw().resetPassword()}),q.qZA(),q.YNc(6,he,2,1,"mat-error",13),q.qZA(),q.TgZ(7,"div",14),q.TgZ(8,"button",15),q._uU(9,"Cancel"),q.qZA(),q.TgZ(10,"app-save-button",16),q.NdJ("save",function(){return q.CHM(r),q.oxw().resetPassword()}),q.qZA(),q.qZA(),q.qZA(),q.qZA()}if(2&e){var i=q.oxw();q.Q6J("formGroup",i.form),q.xp6(6),q.Q6J("ngForOf",i.validationMessages.password),q.xp6(4),q.Q6J("dirty",i.form.dirty)("valid",i.form.valid)("isSaving",i.isSubmitting)}}function ye(e,t){1&e&&(q.TgZ(0,"div"),q._uU(1," Oops you need to confirm a token to reset a password this way. "),q.qZA())}var Ze=function(){var t=function(t){i(a,t);var o=n(a);function a(t,r,i,n,s){var l;return e(this,a),(l=o.call(this)).fb=t,l.route=r,l.router=i,l.accountService=n,l.messageService=s,l.validationMessages=b.rm,l.TokenStatus=ge,l.currentTokenStatus=(0,T.of)(ge.Validating),l.isSubmitting=!1,l.isLoading=!1,l}return r(a,[{key:"ngOnInit",value:function(){this.form=this.createForm(),this.token=this.route.snapshot.queryParams.token,this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.currentTokenStatus=this.resolveTokenStatus()}},{key:"resolveTokenStatus",value:function(){var e=this;return void 0===this.token?(0,T.of)(ge.Invalid):this.accountService.validateResetToken(this.token).pipe((0,$.P)(),(0,fe.U)(function(t){return e.validateResetTokenResult(t)}),(0,S.K)(function(t){return e.catchErrorMessage("Reset Token Error","The server did not receive a correctly formatted token.")}))}},{key:"validateResetTokenResult",value:function(e){return"Invalid Token"===e.message?(this.messageService.add({severity:Z.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3}),ge.Invalid):ge.Valid}},{key:"fPassword",get:function(){return this.form.get("password")}},{key:"createForm",value:function(){return this.fb.group({password:["",[l.kI.required,l.kI.minLength(6),l.kI.maxLength(20)]]})}},{key:"resetPassword",value:function(){var e=this;this.form.invalid||(this.isSubmitting=!0,this.accountService.resetPassword(this.token,this.fPassword.value,this.fPassword.value).pipe((0,$.P)(),(0,k.b)(function(t){return e.resetPasswordResult(t)}),(0,S.K)(function(t){return e.catchErrorMessage("Password reset Error",t.message)})).subscribe())}},{key:"resetPasswordResult",value:function(e){this.isSubmitting=!1,"Success"===e.message?(this.messageService.add({severity:Z.r.Success,summary:"Password reset",detail:"Password reset you can now login with your new password.",life:8e3}),this.router.navigate(["/account/login"])):this.messageService.add({severity:Z.r.Warning,summary:"Password reset failed",detail:e.message,life:8e3})}},{key:"catchErrorMessage",value:function(e,t){return this.messageService.add({severity:Z.r.Error,summary:e,detail:t,life:8e3}),(0,T.of)(ge.Invalid)}}]),a}(y.V);return t.\u0275fac=function(e){return new(e||t)(q.Y36(l.qu),q.Y36(w.gz),q.Y36(w.F0),q.Y36(h.B),q.Y36(A.e))},t.\u0275cmp=q.Xpm({type:t,selectors:[["app-reset-password-form"]],features:[q.qOj],decls:12,vars:6,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],["mat-card-content","",3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex-box flex-column",4,"ngSwitchCase"],[3,"formGroup",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"flex-box","flex-column"],["mat-flat-button","","color","accent","aria-label","Navigate to forgot password","type","button","routerLink","/account/forgot-password",1,"mt-2","mb-2"],[3,"formGroup"],[1,"mt-1"],["matPrefix","",1,"pr-1"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","password",3,"keyup.enter"],[4,"ngFor","ngForOf"],[1,"flex-box","flex-justify-end","mt-2"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login"],["label","Reset Password",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(q.TgZ(0,"mat-card-header"),q.TgZ(1,"mat-card-title"),q.TgZ(2,"h1",0),q.TgZ(3,"mat-icon",1),q._uU(4,"security icon"),q.qZA(),q._uU(5,"Reset Password "),q.qZA(),q.qZA(),q.qZA(),q.TgZ(6,"div",2),q.ALo(7,"async"),q.YNc(8,de,2,0,"div",3),q.YNc(9,pe,5,0,"div",4),q.YNc(10,we,11,5,"form",5),q.YNc(11,ye,2,0,"div",6),q.qZA()),2&e&&(q.xp6(6),q.Q6J("ngSwitch",q.lcZ(7,4,t.currentTokenStatus)),q.xp6(2),q.Q6J("ngSwitchCase",t.TokenStatus.Validating),q.xp6(1),q.Q6J("ngSwitchCase",t.TokenStatus.Invalid),q.xp6(1),q.Q6J("ngSwitchCase",t.TokenStatus.Valid))},directives:[c.dk,c.n5,d.Hw,c.dn,s.RF,s.n9,s.ED,u.lW,w.rH,l._Y,l.JL,l.sg,f.KE,f.qo,p.Nt,l.Fj,l.JJ,l.u,s.sg,I.t,f.TO,s.O5],pipes:[s.Ov],styles:["h2[_ngcontent-%COMP%]{display:flex}"]}),t}();function be(e,t){1&e&&(q.TgZ(0,"div"),q._uU(1," Verifying... "),q.qZA())}function Te(e,t){1&e&&(q.TgZ(0,"p"),q._uU(1,"Unfortunately, the verify email token failed, you can get a new token at "),q.qZA(),q.TgZ(2,"button",5),q._uU(3,"Forgot Password"),q.qZA())}var ke,Se,xe=[{path:"",component:D,children:[{path:"login",component:R},{path:"register",component:ce},{path:"verify-email",component:(ke=function(){function t(r,i,o,n){e(this,t),this.route=r,this.router=i,this.accountService=o,this.messageService=n,this.EmailStatus=me,this.emailStatus=me.Verifying,this.addMessages={emailVerifiedSuccess:{severity:Z.r.Success,summary:"Email Verified",detail:"Well done, email verified, please login to start making amazing recipes.",life:8e3},tokenUndefined:{severity:Z.r.Error,summary:"Invalid Token",detail:"Please obtain a new verify token.",life:8e3},verificationFailed:{severity:Z.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3},catchErrorFail:{severity:Z.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3}}}return r(t,[{key:"ngOnInit",value:function(){this.token=this.route.snapshot.queryParams.token,this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.verifyToken()}},{key:"verifyToken",value:function(){var e=this;void 0===this.token?(this.emailStatus=me.Failed,this.messageService.add(this.addMessages.tokenUndefined)):this.accountService.verifyEmail(this.token).pipe((0,$.P)(),(0,k.b)(function(t){return e.verifyTokenResult(t)}),(0,S.K)(function(t){return e.catchError(t)})).subscribe()}},{key:"verifyTokenResult",value:function(e){"Verification Failed"===e.message?(this.messageService.add(this.addMessages.verificationFailed),this.emailStatus=me.Failed):(this.messageService.add(this.addMessages.emailVerifiedSuccess),this.router.navigate(["/account/login"]))}},{key:"catchError",value:function(e){return this.messageService.add(this.addMessages.catchErrorFail),this.emailStatus=me.Failed,(0,T.of)()}}]),t}(),ke.\u0275fac=function(e){return new(e||ke)(q.Y36(w.gz),q.Y36(w.F0),q.Y36(h.B),q.Y36(A.e))},ke.\u0275cmp=q.Xpm({type:ke,selectors:[["app-verify-email"]],decls:10,vars:2,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],["mat-card-content",""],[4,"ngIf","ngIfElse"],["showFailed",""],["mat-flat-button","","color","accent","aria-label","Navigate to register","type","button","routerLink","/account/register",1,"mt-2","mb-2"]],template:function(e,t){if(1&e&&(q.TgZ(0,"mat-card-header"),q.TgZ(1,"mat-card-title"),q.TgZ(2,"h1",0),q.TgZ(3,"mat-icon",1),q._uU(4,"security icon"),q.qZA(),q._uU(5,"Reset Password"),q.qZA(),q.qZA(),q.qZA(),q.TgZ(6,"div",2),q.YNc(7,be,2,0,"div",3),q.YNc(8,Te,4,0,"ng-template",null,4,q.W1O),q.qZA()),2&e){var r=q.MAs(9);q.xp6(7),q.Q6J("ngIf",t.emailStatus===t.EmailStatus.Verifying)("ngIfElse",r)}},directives:[c.dk,c.n5,d.Hw,c.dn,s.O5,u.lW,w.rH],styles:[""]}),ke)},{path:"forgot-password",component:P},{path:"reset-password",component:Ze}]}],qe=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=q.oAB({type:t}),t.\u0275inj=q.cJS({imports:[[w.Bz.forChild(xe)],w.Bz]}),t}(),Ae=((Se=function t(){e(this,t)}).\u0275fac=function(e){return new(e||Se)},Se.\u0275mod=q.oAB({type:Se}),Se.\u0275inj=q.cJS({providers:[h.B],imports:[[s.ez,l.UX,qe,d.Ps,c.QW,f.lN,g.t,p.c,u.ot,m.p9,v.v]]}),Se)}}])}();