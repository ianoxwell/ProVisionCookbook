  <mat-toolbar class="flex-box flex-justify-space-between">
    <h2>
    	{{(isNew) ? 'New' : 'Edit'}} Ingredient
	</h2>
      <button mat-flat-button color="warn" *ngIf="!isNew" type="button" title="delete" (click)="deleteIngredient(selected)">
        <mat-icon>delete</mat-icon>
        Delete Ingredient
      </button>
  </mat-toolbar>

<form [formGroup]="ingredientForm" fxLayout="column" class="p-3" style="overflow-y: auto;" *ngIf="!!ingredientForm">
	<section>
		<h3>Details</h3>
		<mat-form-field class="mr-2 w-30">
			<mat-icon matPrefix class="pr-1">beach_access</mat-icon>
			<input matInput type="text" placeholder="Name *" Title="Name" formControlName="name">
			<mat-error *ngFor="let validation of validationMessages.reasonControl">
				<mat-error class="error-message" *ngIf="nameControl.hasError(validation.type) && (nameControl.dirty || nameControl.touched)">
						<span [innerHTML]="validation.message"></span>
				</mat-error>
			</mat-error>
		</mat-form-field>
		<!-- <span class="p-float-label">
			
			<app-drop-down inputid="parentId" [options]="parentType" optionLabel="value" formControlName="parent" showClear="true"></app-drop-down>
			<label for="parentId">Parent / Type</label>
		</span> -->
		<mat-form-field class="mr-2">
			<mat-label id="parent-label">Food Group</mat-label>
			<mat-select placeholder="Food Group" role="" formControlName="foodGroup" >
				<div role="listbox" aria-labelledby="parent-label">
					<mat-option role="option" *ngFor="let parent of refData.IngredientParentType" [value]="parent.id" >{{parent.title}}</mat-option>
				</div>
			</mat-select>
		</mat-form-field>
		<mat-form-field class="mr-2">
			<mat-label id="ex1-label" for="ex1-listbox">Consistency / state</mat-label>
			<mat-select id="constanceId" role="" placeholder="Consistency" formControlName="consistency" [attr.aria-owns]="'ex1-listbox'" aria-haspopup="listbox" >				
				<div role="listbox" aria-labelledby="ex1-label">
					<mat-option role="option" *ngFor="let consistency of refData.IngredientState" [value]="consistency.id" >{{consistency.title}}</mat-option>
				</div>
			</mat-select>
		</mat-form-field>
		<mat-form-field class="mr-2">
			<mat-label id="allergy-label">Food Allergies</mat-label>
			<mat-select placeholder="Allergies" role="" formControlName="allergies" multiple>
				<div role="listbox" aria-labelledby="allergy-label">
					<mat-option role="option" *ngFor="let allergy of refData.AllergyWarning" [value]="allergy.id">{{allergy.title}}</mat-option>
				</div>
			</mat-select>
		</mat-form-field>
		<mat-form-field class="pr-1">
			<mat-label id="purchased-by-label">Generally Purchased By</mat-label>
			<mat-select placeholder="Purchased By" role="" formControlName="purchasedBy">
				<div role="listbox" aria-labelledby="purchased-by-label">
					<mat-option role="option" *ngFor="let type of purchasedByEnum" [value]="type.id" >{{type.item | toTitleCase}}</mat-option>
				</div>
			</mat-select>
		</mat-form-field>
		<!-- TODO make visible only to ADMIN -->
		<span>
			<mat-form-field>
				<input matInput type="text" placeholder="Link Id" formControlName="linkUrl">
			</mat-form-field>
			<!-- <button mat-flat-button aria-label="Refresh data online" (click)="refreshData()" [disabled]="!linkUrl.value || linkUrl.value.length === 0">Refresh Data online</button> -->
		</span>
	</section>
	<section [formGroup]="caloricBreakdown">
		<h3>Caloric Breakdown</h3>
		<div class="flex-box flex-row">
			<div class="flex-box flex-column w-50">
				<div>
					<mat-label for="percentCarbsSlider" id="percentCarbsLabel" class="mr-2">Carbohydrates</mat-label>
					<mat-slider id="percentCarbsSlider" formControlName="carbohydrate" aria-labelledby="percentCarbsLabel" thumbLabel tickInterval="1" min="0" max="100"></mat-slider>
				</div>
				<div>
					<mat-label for="percentFatSlider" id="percentFatLabel" class="mr-2">Fat</mat-label>
					<mat-slider id="percentFatSlider" formControlName="fat" aria-labelledby="percentFatLabel" thumbLabel tickInterval="1" min="0" max="100"></mat-slider>
				</div>
				<div>
					<mat-label for="percentProteinSlider" id="percentProteinLabel" class="mr-2">Protein</mat-label>
					<mat-slider id="percentProteinSlider" formControlName="protein" aria-labelledby="percentProteinLabel" thumbLabel tickInterval="1" min="0" max="100"></mat-slider>
				</div>
				<div>
					<mat-label for="percentWaterSlider" id="percentWaterLabel" class="mr-2">Water</mat-label>
					<mat-slider id="percentWaterSlider" formControlName="water" aria-labelledby="percentWaterLabel" thumbLabel tickInterval="1" min="0" max="100"></mat-slider>
				</div>				
			</div>

		</div>
	</section>
	<section class="mt-2 mb-2">
		<div class="flex-box flex-justify-space-between">
			<h3>Nutrition Facts</h3>
			<h4>Serving Size - 100grams (100g)</h4>
		</div>
		<mat-form-field class="pr-1">
			<mat-label>Calories</mat-label>
			<input type="number" matInput formControlName="calories"/>
		</mat-form-field>
		<app-nutrition-facts-edit [nutritionFacts]="nutritionFacts" (markAsDirty)="nutritionFacts.markAsDirty()"></app-nutrition-facts-edit>
		<!-- <app-ingredient-nutrition-form *ngFor="let neutrino of nutrition.controls; index as i"
			[nutrition]="neutrino" [index]="i"
			(markAsDirty)="nutrition.markAsDirty()"
			(deleteItem)="deleteSubDocument('nutrition', neutrino.value._id, i)">
		</app-ingredient-nutrition-form> -->
	</section>

    <section class="mt-2 mb-2">
		<app-ingredient-prices-form 
			[price]="price"
			[measurements]="measurements"
			(markAsDirty)="price.markAsDirty()">
		</app-ingredient-prices-form>
		<!-- <div class="flex-box flex-justify-space-between flex-row">
			<span class="flex-box flex-row flex-align-items-center">
				<h3 class="toolbar-second-title mr-2">Prices</h3>
				<span class="toolbar-second-subheading">Average Price: {{selected.averagePrice}} - Count: {{selected.prices?.length}}</span>
			</span>
			<button mat-icon-button color="accent" (click)="addSubDocument('prices')" type="button" title="add"><mat-icon>add</mat-icon></button>
		</div>
		<div *ngFor="let price of prices.controls; index as i">

		</div> -->
    </section>
    <section class="mt-2 mb-2">
		<div class="flex-box flex-justify-space-between">
			<span class="flex-box flex-row flex-align-items-center">
				<h3 class="toolbar-second-title mr-2">Conversions</h3>
				<span class="toolbar-second-subheading">{{selected.ingredientConversions?.length}}</span>
			</span>
			<button mat-icon-button color="accent" (click)="addSubDocument('conversions')" type="button" title="add"><mat-icon>add</mat-icon></button>
		</div>
		<div cdkDropList (cdkDropListDropped)="dragNDrop($event)" [cdkDropListData]="selected.ingredientConversions" class="p-2">
			<div cdkDrag *ngFor="let convert of conversions.controls; index as i">
				<app-ingredient-conversion-form
					[convert]="convert"
					[measurements]="measurements"
					[ingredientState]="refData.ingredientState"
					(markAsDirty)="conversions.markAsDirty()"
					(deleteItem)="deleteSubDocument('conversions', convert.value._id, i)">
				</app-ingredient-conversion-form>
			</div>
		</div>
    </section>
	<!-- Recipes with this ingredient -->
    <section *ngIf="!isNew" class="mt-2 mb-2">	
    	<h3 >Recipes this ingredient is used in: {{singleIngredient.recipes.length}}</h3>
	  	<div *ngFor="let recipe of singleIngredient.recipes" class="recipe-wrapper">
		  	<span>
			  <a class="recipe-link" [routerLink]="'/savoury/recipes/item/' + recipe.id">{{recipe.name}}</a>
			</span>
			<!-- <span class="ml-2" *ngFor="let recipeType of recipe.recipeType">
				{{recipeType | sentenceCase}}
			</span> -->
	  	</div>
    </section>
  	<div *ngIf="!isNew" class="text-really-small text-muted">
		<span>Created: {{selected.createdAt | date}}</span>
		<span class="margin-left-1em">Last Modified: {{selected.updatedAt | date}}</span>
	</div>
</form>
<div class="mb-2 flex-box flex-end">
	<span class="flex-box flex-align-items-center mr-4">
		<button type="button" mat-flat-button title="Cancel" (click)="back.emit()" class="mr-2">Cancel</button>
		<app-save-button color="accent" [isSaving]="isSavingResults" [dirty]="ingredientForm.dirty" [valid]="ingredientForm.valid" (save)="onSaveItem()"></app-save-button>
		<!-- <button type="button" mat-flat-button title="Submit" color="accent" [disabled]="!ingredientForm.valid" (click)="onSaveItem()" class="mr-2">{{(isNew) ? 'New' : 'Save'}}</button> -->
	</span>
</div>
