(self.webpackChunkcook_book=self.webpackChunkcook_book||[]).push([[823],{8823:function(e,t,r){"use strict";r.r(t),r.d(t,{AccountModule:function(){return ye}});var i=r(8583),s=r(3679),o=r(1095),a=r(3738),n=r(7539),l=r(1769),c=r(8295),m=r(6627),g=r(9983),u=r(6398),d=r(9876),f=r(3423),h=r(6025),p=r(1209),v=r(7851),w=r(5917),Z=r(3342),b=r(5304),y=r(6782),T=r(7716),S=r(2684),x=r(448);function k(e,t){if(1&e&&(T.TgZ(0,"mat-error",14),T._UZ(1,"span",15),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function q(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,k,2,1,"mat-error",13),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(2);T.xp6(1),T.Q6J("ngIf",r.f.email.hasError(e.type)&&(r.f.email.dirty||r.f.email.touched))}}function A(e,t){if(1&e){const e=T.EpF();T.TgZ(0,"form",5),T.TgZ(1,"mat-form-field",6),T.TgZ(2,"mat-icon",7),T._uU(3,"email"),T.qZA(),T.TgZ(4,"input",8),T.NdJ("keyup.enter",function(){return T.CHM(e),T.oxw().forgotPassword()}),T.qZA(),T.YNc(5,q,2,1,"mat-error",9),T.qZA(),T.TgZ(6,"div",10),T.TgZ(7,"button",11),T._uU(8,"Cancel"),T.qZA(),T.TgZ(9,"app-save-button",12),T.NdJ("save",function(){return T.CHM(e),T.oxw().forgotPassword()}),T.qZA(),T.qZA(),T.qZA()}if(2&e){const e=T.oxw();T.Q6J("formGroup",e.form),T.xp6(5),T.Q6J("ngForOf",e.validationMessages.email),T.xp6(4),T.Q6J("dirty",e.form.dirty)("valid",e.form.valid)("isSaving",e.isSubmitting)}}function I(e,t){1&e&&(T.TgZ(0,"div"),T._uU(1," Please check your email or your spam folder for a password reset link. "),T.qZA())}let N=(()=>{class e extends h.V{constructor(e,t,r,i,s,o){super(),this.fb=e,this.route=t,this.router=r,this.accountService=i,this.messageService=s,this.cdr=o,this.validationMessages=v.rm,this.showLookInYourEmail=!1,this.isSubmitting=!1,this.form=this.createForm()}ngOnInit(){const e=this.route.snapshot.queryParams.email;void 0!==e&&(this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.f.email.setValue(e),this.f.email.markAsTouched(),this.f.email.markAsDirty())}get f(){return this.form.controls}createForm(){return this.fb.group({email:["",[s.kI.required,s.kI.minLength(2),s.kI.maxLength(120),s.kI.email]]})}forgotPassword(){this.form.invalid||(this.isSubmitting=!0,this.accountService.forgotPassword(this.form.getRawValue().email).pipe((0,Z.b)(e=>{"Please login through your Google Account"===e.message?(this.messageService.add({severity:p.r.Warning,summary:"No Password to reset",detail:e.message,life:8e3}),this.f.email.setErrors({googleLogin:!0}),this.cdr.markForCheck(),this.form.updateValueAndValidity()):this.showLookInYourEmail=!0,this.isSubmitting=!1,console.log("email send result",e,this.isSubmitting)}),(0,b.K)(e=>(400===e.status&&this.messageService.add({severity:p.r.Error,summary:"Email Error",detail:"The server did not receive a correctly formatted email address.",life:8e3}),404===e.status&&(this.messageService.add({severity:p.r.Warning,summary:"No Email account found",detail:e.error.message,life:8e3}),this.f.email.setErrors({registrationRequired:!0},{emitEvent:!0}),this.cdr.markForCheck()),this.isSubmitting=!1,(0,w.of)())),(0,y.R)(this.ngUnsubscribe)).subscribe(e=>{console.log("we got to the subscribe conclusion?",e,this.isSubmitting),this.isSubmitting=!1}))}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(s.qu),T.Y36(f.gz),T.Y36(f.F0),T.Y36(d.B),T.Y36(S.e),T.Y36(T.sBO))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-forgot-password"]],features:[T.qOj],decls:9,vars:2,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],[3,"ngSwitch"],["mat-card-content","",3,"formGroup",4,"ngSwitchDefault"],[4,"ngSwitchCase"],["mat-card-content","",3,"formGroup"],[1,"mt-1","w-100"],["matPrefix","",1,"pr-1"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","email",3,"keyup.enter"],[4,"ngFor","ngForOf"],[1,"flex-box","flex-justify-end","mt-4"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login",1,"mr-1"],["label","Submit",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(T.TgZ(0,"mat-card-header"),T.TgZ(1,"mat-card-title"),T.TgZ(2,"h2",0),T.TgZ(3,"mat-icon",1),T._uU(4,"memory"),T.qZA(),T._uU(5,"Forgot Password"),T.qZA(),T.qZA(),T.qZA(),T.TgZ(6,"div",2),T.YNc(7,A,10,5,"form",3),T.YNc(8,I,2,0,"div",4),T.qZA()),2&e&&(T.xp6(6),T.Q6J("ngSwitch",t.showLookInYourEmail),T.xp6(2),T.Q6J("ngSwitchCase",!0))},directives:[a.dk,a.n5,m.Hw,i.RF,i.ED,i.n9,s._Y,s.JL,a.dn,s.sg,c.KE,c.qo,g.Nt,s.Fj,s.JJ,s.u,i.sg,o.lW,f.rH,x.t,c.TO,i.O5],styles:[""]}),e})();var U=r(8948),J=r(5798),E=r(8851);const P=["passwordInput"];function F(e,t){if(1&e&&(T.TgZ(0,"mat-error",23),T._UZ(1,"span",24),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function C(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,F,2,1,"mat-error",22),T.qZA()),2&e){const e=t.$implicit,r=T.oxw();T.xp6(1),T.Q6J("ngIf",r.f.usernameControl.hasError(e.type)&&(r.f.usernameControl.dirty||r.f.usernameControl.touched))}}function Y(e,t){if(1&e&&(T.TgZ(0,"mat-error",23),T._UZ(1,"span",24),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function _(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,Y,2,1,"mat-error",22),T.qZA()),2&e){const e=t.$implicit,r=T.oxw();T.xp6(1),T.Q6J("ngIf",r.f.passwordControl.hasError(e.type)&&(r.f.passwordControl.dirty||r.f.passwordControl.touched))}}let O=(()=>{class e extends h.V{constructor(e,t,r,i,s,o){super(),this.fb=e,this.authService=t,this.loginService=r,this.router=i,this.messageService=s,this.cdr=o,this.validationMessages=v.rm,this.isSubmitting=!1}ngOnInit(){this.loginForm=this.createForm()}get f(){return this.loginForm.controls}createForm(){return this.fb.group({usernameControl:["",[s.kI.required,s.kI.minLength(2),s.kI.maxLength(120),s.kI.email]],passwordControl:["",[s.kI.required,s.kI.minLength(2)]],rememberControl:!1})}rememberChange(e){console.log("Im not going to remember you, terrible with names",e)}login(){if(this.isSubmitting=!0,this.loginForm.invalid)return null;this.passwordInput.nativeElement.blur();const e=this.loginForm.getRawValue();this.loginService.login(e.usernameControl,e.passwordControl,!1).pipe((0,Z.b)(t=>this.loginResult(t,e)),(0,b.K)(e=>this.catchFormError(e)),(0,y.R)(this.ngUnsubscribe)).subscribe()}loginResult(e,t){if(this.isSubmitting=!1,"Successful login"===e.message)this.router.navigate(["/savoury/recipes/browse"]);else if(e.message.indexOf("Lockout")>-1){const r=Number(e.message.substring(9));r&&r>4&&(console.log("here we locking routing,",r,`/account/forgot-password?email=${t.usernameControl}`),this.router.navigate(["/account/forgot-password"],{queryParams:{email:t.usernameControl}}),this.messageService.add({severity:p.r.Warning,summary:"Lockout",detail:"Please wait 20 minutes to try again or reset password.",life:12e3}))}else this.messageService.add({severity:p.r.Warning,summary:"Login problem",detail:e.message,life:12e3})}catchFormError(e){return this.isSubmitting=!1,e.status===U.WE.BadRequest?(this.f.passwordControl.setErrors({wrongPassword:!0},{emitEvent:!0}),this.cdr.markForCheck(),this.messageService.add({severity:p.r.Warning,summary:"Password error",detail:'You can reset your password through "Forgot Password"',life:12e3})):this.messageService.add(e.status===U.WE.Forbidden?{severity:p.r.Warning,summary:"Account Issue",detail:'Your Account has been deactivated, please email support for more info."',life:12e3}:{severity:p.r.Error,summary:"Major Error",detail:e.message,life:12e3}),(0,w.of)()}googleSignIn(){this.authService.signIn(E.tV.PROVIDER_ID)}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(s.qu),T.Y36(E.xE),T.Y36(J.r),T.Y36(f.F0),T.Y36(S.e),T.Y36(T.sBO))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-login-form"]],viewQuery:function(e,t){if(1&e&&T.Gf(P,5),2&e){let e;T.iGM(e=T.CRH())&&(t.passwordInput=e.first)}},features:[T.qOj],decls:39,vars:6,consts:[[1,"flex-box","flex-align-center"],["aria-hidden","false","aria-label","User Login",1,"mr-2"],["mat-card-content","",3,"formGroup"],[1,"flex-box","flex-column",3,"keyup.enter"],[1,"mt-1"],["matPrefix","",1,"pr-1"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","usernameControl"],[4,"ngFor","ngForOf"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","passwordControl"],["passwordInput",""],[1,"flex-box","flex-justify-space-between","flex-align-center","mt-2"],["aria-label","Remember Me","formControlName","rememberControl",3,"change"],["mat-flat-button","","type","button","aria-label","Need an email password reminder?","routerLink","/account/forgot-password"],[1,"mt-4","mb-4","flex-box","flex-column"],["color","accent","label","Login","iconName","chevron_right","iconPosition","right",3,"dirty","valid","isSaving","save"],[1,"pcb-divider"],["mat-flat-button","","color","primary","type","button","aria-label","Sign in with Google button",1,"w-100",3,"click"],[1,"flex-box","flex-row","flex-align-center"],["src","assets/svg/google.svg","title","Google Icon",1,"svg-icon"],[1,"flex-grow-1","flex-box","flex-justify-center"],[1,"pl-2"],["mat-flat-button","","type","button","routerLink","/account/register","aria-label","Sign up Button"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(T.TgZ(0,"mat-card-header"),T.TgZ(1,"mat-card-title"),T.TgZ(2,"h1",0),T.TgZ(3,"mat-icon",1),T._uU(4,"account_circle"),T.qZA(),T._uU(5,"Login"),T.qZA(),T.qZA(),T.qZA(),T.TgZ(6,"form",2),T.TgZ(7,"div",3),T.NdJ("keyup.enter",function(){return t.login()}),T.TgZ(8,"mat-form-field",4),T.TgZ(9,"mat-icon",5),T._uU(10,"email"),T.qZA(),T._UZ(11,"input",6),T.YNc(12,C,2,1,"mat-error",7),T.qZA(),T.TgZ(13,"mat-form-field",4),T.TgZ(14,"mat-icon",5),T._uU(15,"lock"),T.qZA(),T._UZ(16,"input",8,9),T.YNc(18,_,2,1,"mat-error",7),T.qZA(),T.qZA(),T.TgZ(19,"div",10),T.TgZ(20,"mat-checkbox",11),T.NdJ("change",function(e){return t.rememberChange(e)}),T._uU(21,"Remember Me"),T.qZA(),T.TgZ(22,"button",12),T._uU(23,"Forgot password?"),T.qZA(),T.qZA(),T.TgZ(24,"div",13),T.TgZ(25,"app-save-button",14),T.NdJ("save",function(){return t.login()}),T.qZA(),T.TgZ(26,"div",15),T._uU(27,"OR"),T.qZA(),T.TgZ(28,"button",16),T.NdJ("click",function(){return t.googleSignIn()}),T.TgZ(29,"span",17),T._UZ(30,"img",18),T.TgZ(31,"span",19),T._uU(32,"Continue with Google"),T.qZA(),T.qZA(),T.qZA(),T.qZA(),T.qZA(),T._UZ(33,"mat-divider"),T.TgZ(34,"mat-card-footer",17),T.TgZ(35,"span",20),T._uU(36,"New to Provisioner's CookBook?"),T.qZA(),T.TgZ(37,"button",21),T._uU(38,"Register now!"),T.qZA(),T.qZA()),2&e&&(T.xp6(6),T.Q6J("formGroup",t.loginForm),T.xp6(6),T.Q6J("ngForOf",t.validationMessages.email),T.xp6(6),T.Q6J("ngForOf",t.validationMessages.password),T.xp6(7),T.Q6J("dirty",t.loginForm.dirty)("valid",t.loginForm.valid)("isSaving",t.isSubmitting))},directives:[a.dk,a.n5,m.Hw,s._Y,s.JL,a.dn,s.sg,c.KE,c.qo,g.Nt,s.Fj,s.JJ,s.u,i.sg,n.oG,o.lW,f.rH,x.t,l.d,a.rt,c.TO,i.O5],styles:['.mat-card-footer[_ngcontent-%COMP%]{height:3em;display:flex}.pcb-divider[_ngcontent-%COMP%]{overflow:hidden;text-align:center;margin-top:1em;margin-bottom:1em}.pcb-divider[_ngcontent-%COMP%]:after, .pcb-divider[_ngcontent-%COMP%]:before{content:"";display:inline-block;background-color:#eee3d5;height:1px;position:relative;vertical-align:middle;width:50%}.pcb-divider[_ngcontent-%COMP%]:before{right:.5em;margin-left:-50%}.pcb-divider[_ngcontent-%COMP%]:after{left:.5em;margin-right:-50%}']}),e})();var L=r(3720),M=r(1188),Q=r(8069);function G(e,t){1&e&&(T.TgZ(0,"mat-card"),T._UZ(1,"router-outlet"),T.qZA())}function R(e,t){1&e&&T._UZ(0,"app-loading-indicator")}let V=(()=>{class e extends h.V{constructor(e,t,r,i,s,o){super(),this.authService=e,this.dialogService=t,this.loginService=r,this.router=i,this.messageService=s,this.storageService=o,this.isGettingJwt=!1}ngOnInit(){const e=this.storageService.getItem("google-user");e&&e.length>0&&"null"!==e?this.getGoogleJwtToken(e):this.listenAuthState()}listenAuthState(){this.authService.authState.pipe((0,Z.b)(e=>{this.messageService.add({severity:p.r.Success,summary:"Authentication Successful",detail:"Google Account Authenticated, attempting to logon to app."}),e?(this.googleUserData=e,this.storageService.setItem("google-user",JSON.stringify(this.googleUserData)),JSON.parse(this.storageService.getItem("user")),this.getGoogleJwtToken(this.googleUserData)):localStorage.setItem("google-user",null),this.loggedIn=null!=e}),(0,b.K)(e=>this.dialogService.confirm(p.r.Alert,"Error on Google login attempt",e.message)),(0,y.R)(this.ngUnsubscribe)).subscribe()}getGoogleJwtToken(e){this.isGettingJwt=!0,this.loginService.getTokenUsingGoogleToken(e).pipe((0,Z.b)(e=>{this.isGettingJwt=!1,e&&"string"==typeof e?(this.dialogService.confirm(p.r.Information,"Registration required","We currently don't have an account registered to that address."),this.router.navigate(["/account/register"])):this.router.navigate(["/savoury/recipes"])}),(0,b.K)(e=>(e.status===U.WE.Forbidden&&"OK"===e.statusText&&(this.dialogService.confirm(p.r.Alert,"403 response","Likely the cached google token has expired, try refreshing browser and logging in with your Google account again."),this.googleClear()),this.dialogService.alert("Google Login Error",e.message),this.isGettingJwt=!1,(0,w.of)())),(0,y.R)(this.ngUnsubscribe)).subscribe()}googleClear(){localStorage.setItem("google-user",null)}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(E.xE),T.Y36(L.x),T.Y36(J.r),T.Y36(f.F0),T.Y36(S.e),T.Y36(M.V))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-login"]],features:[T.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["showLoading",""]],template:function(e,t){if(1&e&&(T.YNc(0,G,2,0,"mat-card",0),T.YNc(1,R,1,0,"ng-template",null,1,T.W1O)),2&e){const e=T.MAs(2);T.Q6J("ngIf",!t.isGettingJwt)("ngIfElse",e)}},directives:[i.O5,a.a8,f.lC,Q.Q],styles:[""]}),e})();class H{constructor(){this.loginProvider="Local"}}var W=r(8049),D=r(5435),j=r(3190);function $(e,t){if(1&e&&(T.TgZ(0,"mat-error",19),T._UZ(1,"span",20),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function B(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,$,2,1,"mat-error",18),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(2);T.xp6(1),T.Q6J("ngIf",r.f.firstName.hasError(e.type)&&(r.f.firstName.dirty||r.f.firstName.touched))}}function K(e,t){if(1&e&&(T.TgZ(0,"mat-error",19),T._UZ(1,"span",20),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function z(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,K,2,1,"mat-error",18),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(2);T.xp6(1),T.Q6J("ngIf",r.f.lastName.hasError(e.type)&&(r.f.lastName.dirty||r.f.lastName.touched))}}function X(e,t){if(1&e&&(T.TgZ(0,"mat-error",19),T._UZ(1,"span",20),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function ee(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,X,2,1,"mat-error",18),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(2);T.xp6(1),T.Q6J("ngIf",r.f.email.hasError(e.type)&&(r.f.email.dirty||r.f.email.touched))}}function te(e,t){if(1&e&&(T.TgZ(0,"mat-error",19),T._UZ(1,"span",20),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function re(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,te,2,1,"mat-error",18),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(3);T.xp6(1),T.Q6J("ngIf",r.f.password.hasError(e.type)&&(r.f.password.dirty||r.f.password.touched))}}function ie(e,t){if(1&e&&(T.TgZ(0,"div"),T.TgZ(1,"mat-form-field",11),T._UZ(2,"input",21),T.YNc(3,re,2,1,"mat-error",8),T.qZA(),T.qZA()),2&e){const e=T.oxw(2);T.xp6(3),T.Q6J("ngForOf",e.validationMessages.password)}}function se(e,t){if(1&e){const e=T.EpF();T.TgZ(0,"form",4),T.NdJ("keyup.enter",function(){return T.CHM(e),T.oxw().register()}),T.TgZ(1,"div",5),T.TgZ(2,"mat-form-field",6),T._UZ(3,"input",7),T.YNc(4,B,2,1,"mat-error",8),T.qZA(),T.TgZ(5,"mat-form-field",9),T._UZ(6,"input",10),T.YNc(7,z,2,1,"mat-error",8),T.qZA(),T.qZA(),T.TgZ(8,"div"),T.TgZ(9,"mat-form-field",11),T._UZ(10,"input",12),T.YNc(11,ee,2,1,"mat-error",8),T.qZA(),T.qZA(),T.YNc(12,ie,4,1,"div",3),T.TgZ(13,"div",13),T.TgZ(14,"mat-checkbox",14),T.NdJ("change",function(){return T.CHM(e),T.oxw().form.markAsTouched()}),T._uU(15,"Accept Terms and conditions (when we get some)"),T.qZA(),T.qZA(),T.TgZ(16,"div",15),T.TgZ(17,"button",16),T._uU(18,"Cancel"),T.qZA(),T.TgZ(19,"app-save-button",17),T.NdJ("save",function(){return T.CHM(e),T.oxw().register()}),T.qZA(),T.qZA(),T.qZA()}if(2&e){const e=T.oxw();T.Q6J("formGroup",e.form),T.xp6(4),T.Q6J("ngForOf",e.validationMessages.username),T.xp6(3),T.Q6J("ngForOf",e.validationMessages.username),T.xp6(4),T.Q6J("ngForOf",e.validationMessages.email),T.xp6(1),T.Q6J("ngIf","GOOGLE"!==e.newUser.loginProvider),T.xp6(7),T.Q6J("dirty",e.form.dirty)("valid",e.form.valid)("isSaving",e.isSubmitting)}}function oe(e,t){1&e&&(T.TgZ(0,"div"),T.TgZ(1,"p"),T.TgZ(2,"strong"),T._uU(3,"Note"),T.qZA(),T._uU(4," - Email is currently trapped in mailtrap.io"),T.qZA(),T.TgZ(5,"p"),T._uU(6,"Please look in your email account (or double check your spam) for a registration email."),T.qZA(),T.qZA())}let ae=(()=>{class e extends h.V{constructor(e,t,r,i,s,o){super(),this.formBuilder=e,this.accountService=t,this.loginService=r,this.messageService=i,this.storageService=s,this.router=o,this.newUser=new H,this.validationMessages=v.rm,this.displayAwaitingVerificationEmail=!1,this.isSubmitting=!1}ngOnInit(){const e=this.storageService.getItem("google-user");if(e){const t=JSON.parse(e);this.newUser=t&&null!==t?{firstName:t.firstName,lastName:t.lastName,email:t.email,loginProvider:t.provider,loginProviderId:t.id,photoUrl:t.photoUrl,verified:new Date}:new H}this.createForm(this.newUser)}get f(){return this.form.controls}createForm(e){this.form=this.formBuilder.group({firstName:[e.firstName,s.kI.required],lastName:[e.lastName,s.kI.required],email:[e.email,[s.kI.required,s.kI.email]],acceptTerms:[!1,s.kI.requiredTrue]}),"GOOGLE"!==this.newUser.loginProvider?this.form.addControl("password",new s.NI("",[s.kI.required,s.kI.minLength(6)])):this.f.email.disable()}register(){if(this.form.invalid)return;this.isSubmitting=!0;const e=this.form.getRawValue();this.newUser.firstName=e.firstName,this.newUser.lastName=e.lastName,this.newUser.email=e.email,"GOOGLE"!==this.newUser.loginProvider&&(this.newUser.password=e.password),console.log("register the form",this.form.getRawValue(),this.newUser),this.accountService.register(this.newUser).pipe((0,W.P)(),(0,D.h)(e=>(this.isSubmitting=!1,console.log("isSubmitting",this.isSubmitting),"Email address is already registered"===e.message?(this.messageService.add({severity:p.r.Warning,summary:"Email Conflict",detail:"It seems this email account is already registered with us.",life:12e3}),this.f.email.setErrors({emailConflict:!0}),!1):"GOOGLE"===this.newUser.loginProvider||(this.displayAwaitingVerificationEmail=!0,!1))),(0,j.w)(()=>this.loginService.login(this.newUser.email,null,!0)),(0,D.h)(e=>"Successful login"===e.message),(0,Z.b)(()=>this.router.navigate(["/savoury/browse"])),(0,b.K)(e=>(this.isSubmitting=!1,this.messageService.add({severity:p.r.Error,summary:"Something terrible happened",detail:e.message,life:12e3}),(0,w.of)())),(0,y.R)(this.ngUnsubscribe)).subscribe(()=>{this.isSubmitting=!1,console.log("subscription finished",this.isSubmitting)})}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(s.qu),T.Y36(d.B),T.Y36(J.r),T.Y36(S.e),T.Y36(M.V),T.Y36(f.F0))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-register-form"]],features:[T.qOj],decls:8,vars:2,consts:[[1,"flex-box","flex-align-center"],["aria-hidden","false","aria-label","Register New User",1,"mr-2"],["mat-card-content","",3,"formGroup","keyup.enter",4,"ngIf"],[4,"ngIf"],["mat-card-content","",3,"formGroup","keyup.enter"],[1,"flex-box","flex-row","mt-2"],[1,"mr-2","w-45"],["matInput","","type","text","placeholder","First Name *","Title","First Name","formControlName","firstName"],[4,"ngFor","ngForOf"],[1,"w-50"],["matInput","","type","text","placeholder","Last Name *","Title","Last Name","formControlName","lastName"],[1,"w-100"],["matInput","","type","email","placeholder","Email *","Title","Email","formControlName","email"],[1,"mt-2","mb-4"],["aria-label","Accept Terms and conditions","formControlName","acceptTerms",3,"change"],[1,"flex-box","flex-justify-end"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login",1,"mr-1"],["color","accent","iconName","chevron_right","iconPosition","right","label","Register",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","password"]],template:function(e,t){1&e&&(T.TgZ(0,"mat-card-header"),T.TgZ(1,"mat-card-title"),T.TgZ(2,"h1",0),T.TgZ(3,"mat-icon",1),T._uU(4,"person_add"),T.qZA(),T._uU(5,"Register"),T.qZA(),T.qZA(),T.qZA(),T.YNc(6,se,20,8,"form",2),T.YNc(7,oe,7,0,"div",3)),2&e&&(T.xp6(6),T.Q6J("ngIf",!!t.form&&!t.displayAwaitingVerificationEmail),T.xp6(1),T.Q6J("ngIf",t.displayAwaitingVerificationEmail))},directives:[a.dk,a.n5,m.Hw,i.O5,s._Y,s.JL,a.dn,s.sg,c.KE,g.Nt,s.Fj,s.JJ,s.u,i.sg,n.oG,o.lW,f.rH,x.t,c.TO],styles:[""]}),e})();var ne=(()=>(function(e){e[e.Verifying=0]="Verifying",e[e.Failed=1]="Failed"}(ne||(ne={})),ne))(),le=(()=>(function(e){e[e.Validating=0]="Validating",e[e.Valid=1]="Valid",e[e.Invalid=2]="Invalid"}(le||(le={})),le))(),ce=r(8002);function me(e,t){1&e&&(T.TgZ(0,"div"),T._uU(1," Validating token... "),T.qZA())}function ge(e,t){1&e&&(T.TgZ(0,"div",7),T.TgZ(1,"span"),T._uU(2,"Token validation failed, you can get a new reset token at "),T.qZA(),T.TgZ(3,"button",8),T._uU(4,"Forgot Password"),T.qZA(),T.qZA())}function ue(e,t){if(1&e&&(T.TgZ(0,"mat-error",18),T._UZ(1,"span",19),T.qZA()),2&e){const e=T.oxw().$implicit;T.xp6(1),T.Q6J("innerHTML",e.message,T.oJD)}}function de(e,t){if(1&e&&(T.TgZ(0,"mat-error"),T.YNc(1,ue,2,1,"mat-error",17),T.qZA()),2&e){const e=t.$implicit,r=T.oxw(2);T.xp6(1),T.Q6J("ngIf",r.fPassword.hasError(e.type)&&(r.fPassword.dirty||r.fPassword.touched))}}function fe(e,t){if(1&e){const e=T.EpF();T.TgZ(0,"form",9),T.TgZ(1,"div",7),T.TgZ(2,"mat-form-field",10),T.TgZ(3,"mat-icon",11),T._uU(4,"lock"),T.qZA(),T.TgZ(5,"input",12),T.NdJ("keyup.enter",function(){return T.CHM(e),T.oxw().resetPassword()}),T.qZA(),T.YNc(6,de,2,1,"mat-error",13),T.qZA(),T.TgZ(7,"div",14),T.TgZ(8,"button",15),T._uU(9,"Cancel"),T.qZA(),T.TgZ(10,"app-save-button",16),T.NdJ("save",function(){return T.CHM(e),T.oxw().resetPassword()}),T.qZA(),T.qZA(),T.qZA(),T.qZA()}if(2&e){const e=T.oxw();T.Q6J("formGroup",e.form),T.xp6(6),T.Q6J("ngForOf",e.validationMessages.password),T.xp6(4),T.Q6J("dirty",e.form.dirty)("valid",e.form.valid)("isSaving",e.isSubmitting)}}function he(e,t){1&e&&(T.TgZ(0,"div"),T._uU(1," Oops you need to confirm a token to reset a password this way. "),T.qZA())}let pe=(()=>{class e extends h.V{constructor(e,t,r,i,s){super(),this.fb=e,this.route=t,this.router=r,this.accountService=i,this.messageService=s,this.validationMessages=v.rm,this.TokenStatus=le,this.currentTokenStatus=(0,w.of)(le.Validating),this.isSubmitting=!1,this.isLoading=!1}ngOnInit(){this.form=this.createForm(),this.token=this.route.snapshot.queryParams.token,this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.currentTokenStatus=this.resolveTokenStatus()}resolveTokenStatus(){return void 0===this.token?(0,w.of)(le.Invalid):this.accountService.validateResetToken(this.token).pipe((0,W.P)(),(0,ce.U)(e=>this.validateResetTokenResult(e)),(0,b.K)(e=>this.catchErrorMessage("Reset Token Error","The server did not receive a correctly formatted token.")))}validateResetTokenResult(e){return"Invalid Token"===e.message?(this.messageService.add({severity:p.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3}),le.Invalid):le.Valid}get fPassword(){return this.form.get("password")}createForm(){return this.fb.group({password:["",[s.kI.required,s.kI.minLength(6),s.kI.maxLength(20)]]})}resetPassword(){this.form.invalid||(this.isSubmitting=!0,this.accountService.resetPassword(this.token,this.fPassword.value,this.fPassword.value).pipe((0,W.P)(),(0,Z.b)(e=>this.resetPasswordResult(e)),(0,b.K)(e=>this.catchErrorMessage("Password reset Error",e.message))).subscribe())}resetPasswordResult(e){this.isSubmitting=!1,"Success"===e.message?(this.messageService.add({severity:p.r.Success,summary:"Password reset",detail:"Password reset you can now login with your new password.",life:8e3}),this.router.navigate(["/account/login"])):this.messageService.add({severity:p.r.Warning,summary:"Password reset failed",detail:e.message,life:8e3})}catchErrorMessage(e,t){return this.messageService.add({severity:p.r.Error,summary:e,detail:t,life:8e3}),(0,w.of)(le.Invalid)}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(s.qu),T.Y36(f.gz),T.Y36(f.F0),T.Y36(d.B),T.Y36(S.e))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-reset-password-form"]],features:[T.qOj],decls:12,vars:6,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],["mat-card-content","",3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex-box flex-column",4,"ngSwitchCase"],[3,"formGroup",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"flex-box","flex-column"],["mat-flat-button","","color","accent","aria-label","Navigate to forgot password","type","button","routerLink","/account/forgot-password",1,"mt-2","mb-2"],[3,"formGroup"],[1,"mt-1"],["matPrefix","",1,"pr-1"],["matInput","","type","password","placeholder","Password *","Title","Password","formControlName","password",3,"keyup.enter"],[4,"ngFor","ngForOf"],[1,"flex-box","flex-justify-end","mt-2"],["mat-flat-button","","type","button","aria-label","Cancel","routerLink","/account/login"],["label","Reset Password",3,"dirty","valid","isSaving","save"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"innerHTML"]],template:function(e,t){1&e&&(T.TgZ(0,"mat-card-header"),T.TgZ(1,"mat-card-title"),T.TgZ(2,"h1",0),T.TgZ(3,"mat-icon",1),T._uU(4,"security icon"),T.qZA(),T._uU(5,"Reset Password "),T.qZA(),T.qZA(),T.qZA(),T.TgZ(6,"div",2),T.ALo(7,"async"),T.YNc(8,me,2,0,"div",3),T.YNc(9,ge,5,0,"div",4),T.YNc(10,fe,11,5,"form",5),T.YNc(11,he,2,0,"div",6),T.qZA()),2&e&&(T.xp6(6),T.Q6J("ngSwitch",T.lcZ(7,4,t.currentTokenStatus)),T.xp6(2),T.Q6J("ngSwitchCase",t.TokenStatus.Validating),T.xp6(1),T.Q6J("ngSwitchCase",t.TokenStatus.Invalid),T.xp6(1),T.Q6J("ngSwitchCase",t.TokenStatus.Valid))},directives:[a.dk,a.n5,m.Hw,a.dn,i.RF,i.n9,i.ED,o.lW,f.rH,s._Y,s.JL,s.sg,c.KE,c.qo,g.Nt,s.Fj,s.JJ,s.u,i.sg,x.t,c.TO,i.O5],pipes:[i.Ov],styles:["h2[_ngcontent-%COMP%]{display:flex}"]}),e})();function ve(e,t){1&e&&(T.TgZ(0,"div"),T._uU(1," Verifying... "),T.qZA())}function we(e,t){1&e&&(T.TgZ(0,"p"),T._uU(1,"Unfortunately, the verify email token failed, you can get a new token at "),T.qZA(),T.TgZ(2,"button",5),T._uU(3,"Forgot Password"),T.qZA())}const Ze=[{path:"",component:V,children:[{path:"login",component:O},{path:"register",component:ae},{path:"verify-email",component:(()=>{class e{constructor(e,t,r,i){this.route=e,this.router=t,this.accountService=r,this.messageService=i,this.EmailStatus=ne,this.emailStatus=ne.Verifying,this.addMessages={emailVerifiedSuccess:{severity:p.r.Success,summary:"Email Verified",detail:"Well done, email verified, please login to start making amazing recipes.",life:8e3},tokenUndefined:{severity:p.r.Error,summary:"Invalid Token",detail:"Please obtain a new verify token.",life:8e3},verificationFailed:{severity:p.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3},catchErrorFail:{severity:p.r.Error,summary:"Invalid Token",detail:"Please obtain a new password reset token.",life:8e3}}}ngOnInit(){this.token=this.route.snapshot.queryParams.token,this.router.navigate([],{relativeTo:this.route,replaceUrl:!0}),this.verifyToken()}verifyToken(){void 0===this.token?(this.emailStatus=ne.Failed,this.messageService.add(this.addMessages.tokenUndefined)):this.accountService.verifyEmail(this.token).pipe((0,W.P)(),(0,Z.b)(e=>this.verifyTokenResult(e)),(0,b.K)(e=>this.catchError(e))).subscribe()}verifyTokenResult(e){"Verification Failed"===e.message?(this.messageService.add(this.addMessages.verificationFailed),this.emailStatus=ne.Failed):(this.messageService.add(this.addMessages.emailVerifiedSuccess),this.router.navigate(["/account/login"]))}catchError(e){return this.messageService.add(this.addMessages.catchErrorFail),this.emailStatus=ne.Failed,(0,w.of)()}}return e.\u0275fac=function(t){return new(t||e)(T.Y36(f.gz),T.Y36(f.F0),T.Y36(d.B),T.Y36(S.e))},e.\u0275cmp=T.Xpm({type:e,selectors:[["app-verify-email"]],decls:10,vars:2,consts:[[1,"flex-box"],["aria-hidden","false","aria-label","Forgot Password",1,"mr-2"],["mat-card-content",""],[4,"ngIf","ngIfElse"],["showFailed",""],["mat-flat-button","","color","accent","aria-label","Navigate to register","type","button","routerLink","/account/register",1,"mt-2","mb-2"]],template:function(e,t){if(1&e&&(T.TgZ(0,"mat-card-header"),T.TgZ(1,"mat-card-title"),T.TgZ(2,"h1",0),T.TgZ(3,"mat-icon",1),T._uU(4,"security icon"),T.qZA(),T._uU(5,"Reset Password"),T.qZA(),T.qZA(),T.qZA(),T.TgZ(6,"div",2),T.YNc(7,ve,2,0,"div",3),T.YNc(8,we,4,0,"ng-template",null,4,T.W1O),T.qZA()),2&e){const e=T.MAs(9);T.xp6(7),T.Q6J("ngIf",t.emailStatus===t.EmailStatus.Verifying)("ngIfElse",e)}},directives:[a.dk,a.n5,m.Hw,a.dn,i.O5,o.lW,f.rH],styles:[""]}),e})()},{path:"forgot-password",component:N},{path:"reset-password",component:pe}]}];let be=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=T.oAB({type:e}),e.\u0275inj=T.cJS({imports:[[f.Bz.forChild(Ze)],f.Bz]}),e})(),ye=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=T.oAB({type:e}),e.\u0275inj=T.cJS({providers:[d.B],imports:[[i.ez,s.UX,be,m.Ps,a.QW,c.lN,l.t,g.c,o.ot,n.p9,u.v]]}),e})()}}]);